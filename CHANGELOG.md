# 变更记录

## v0.1.6（2025-10-27）

### 变更内容
- 修复: 本地附件上传
- 优化
  - 工具描述并增强参数校验
  - 各项逻辑优化

### 测试结果汇总

| 模块 | 通过项 | 未通过项 |
| --- | --- | --- |
| 文章管理 | ✅ 创建文章（支持 Markdown）<br>✅ 编辑文章（标题、内容、设置）<br>✅ 发布/取消发布文章<br>✅ 删除文章（回收站）<br>✅ 列出我的文章（分页、筛选）<br>✅ 草稿管理（查看、编辑草稿）<br>✅ 分类和标签管理<br>✅ 文章置顶/取消置顶<br>✅ 设置封面图片<br>✅ 自定义 URL 别名 | - |
| 分类标签 | ✅ 列出所有分类<br>✅ 创建分类（支持层级结构）<br>✅ 更新分类（名称、描述、封面）<br>✅ 删除分类<br>✅ 获取分类详情<br>✅ 查看分类下的文章<br>✅ 列出所有标签<br>✅ 创建标签（支持颜色）<br>✅ 更新标签（名称、颜色）<br>✅ 删除标签<br>✅ 获取标签详情<br>✅ 查看标签下的文章<br>✅ 控制台标签列表 | - |
| 附件管理 | ✅ 列出附件（支持筛选）<br>✅ 从 URL 上传<br>✅ 删除附件<br>✅ 查看附件详情<br>✅ 创建附件分组<br>✅ 查看存储策略<br>✅ 上传本地文件<br>✅ 附件分组管理 |  |

## v0.1.5（2025-10-25）


### 变更内容
- feat(site): 新增 MCP 工具 `get_halo_base_url`
  - 读取环境变量 `HALO_BASE_URL` 并返回规范化的站点基础链接
  - 无需参数，返回 `ToolResult`，包含来源（env/default）与原始 env 值
- chore(server): 在 `list_tools` 注册并在 `call_tool` 路由处理
- feat(post): 增强文章管理工具支持 Markdown 和 HTML 内容
  - 添加 markdown-it-py 及相关插件作为新的 Markdown 渲染引擎
  - 实现内容格式自动检测和指定格式支持
  - 更新参数校验逻辑和错误提示信息
  - 添加新的依赖项到 pyproject.toml

### 使用示例
- 工具名称：`get_halo_base_url`
- 调用参数：`{}`
- 返回示例：`{"success":true,"message":"已获取 Halo 站点链接地址","data":{"base_url":"https://example.com","source":"env","source_env_var":"HALO_BASE_URL","env_value":"https://example.com"}}`

## v0.1.4（2025-10-25）


### 变更内容
- refactor(tools): 统一工具函数中 HaloClient 的使用方式
  - 修改所有工具函数，支持通过参数传入 HaloClient 实例，避免在函数内部重复创建客户端
  - 同时优化错误处理逻辑，使用 ToolResult 统一返回错误信息格式
- fix(posts): 修复更新文章不生效问题
  - 修复 `update_post_tool` 在更新内容时未正确设置草稿 `spec.rawPatch`/`contentPatch` 导致内容未生效的问题

### 测试结果汇总

| 模块 | 通过项 | 未通过项 |
| --- | --- | --- |
| 文章管理 | ✅ 创建文章（支持 Markdown）<br>✅ 编辑文章（标题、内容、设置）<br>✅ 发布/取消发布文章<br>✅ 删除文章（回收站）<br>✅ 列出我的文章（分页、筛选）<br>✅ 草稿管理（查看、编辑草稿）<br>✅ 分类和标签管理<br>✅ 文章置顶/取消置顶<br>✅ 设置封面图片<br>✅ 自定义 URL 别名 | - |
| 分类标签 | ✅ 列出所有分类<br>✅ 创建分类（支持层级结构）<br>✅ 更新分类（名称、描述、封面）<br>✅ 删除分类<br>✅ 获取分类详情<br>✅ 查看分类下的文章<br>✅ 列出所有标签<br>✅ 创建标签（支持颜色）<br>✅ 更新标签（名称、颜色）<br>✅ 删除标签<br>✅ 获取标签详情<br>✅ 查看标签下的文章<br>✅ 控制台标签列表 | - |
| 附件管理 | ✅ 列出附件（支持筛选）<br>✅ 从 URL 上传<br>✅ 删除附件<br>✅ 查看附件详情<br>✅ 创建附件分组<br>✅ 查看存储策略 | ❌ 上传本地文件<br>❌ 附件分组管理 |